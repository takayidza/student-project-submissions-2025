// @ts-nocheck
const{createApp:createApp}=Vue,api=createAuthenticatedApi();createApp({data:()=>({incidents:[],activeVehicles:5,map:null,markers:[],showDetails:!1,useSatellite:!0,mapLayer:null,showConfirmModal:!1,selectedIncident:{},fetchInterval:null,isLoading:!1,lastUpdated:null}),watch:{useSatellite(t){this.mapLayer&&this.map.removeLayer(this.mapLayer),this.mapLayer=t?L.tileLayer("https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{attribution:"© Google Maps",maxZoom:20}).addTo(this.map):L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors",maxZoom:19}).addTo(this.map)}},computed:{totalIncidents(){return this.incidents.length},averageSeverity(){if(0===this.incidents.length)return 0;return this.incidents.reduce(((t,e)=>t+(e.severity||0)),0)/this.incidents.length}},methods:{toggleDetails(){this.showDetails=!this.showDetails},getSeverityClass:t=>null==t?"bg-gray-100 text-gray-800":t>=7?"bg-red-100 text-red-800":t>=4?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800",getSeverityColor:t=>null==t?"#9CA3AF":t>=7?"#EF4444":t>=4?"#F59E0B":"#10B981",formatSeverity:t=>null!=t?t.toFixed(1):"N/A",createWarningIcon:t=>`\n                        <svg class="icon" viewBox="0 0 24 24" fill="${t}">\n                            <path d="M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"/>\n                        </svg>\n                        <div class="pulse-ring" style="background-color: ${t}"></div>\n                    `,showAttendModal(t){this.selectedIncident=t,this.showConfirmModal=!0},cancelAttend(){this.showConfirmModal=!1,this.selectedIncident={}},confirmAttend(){console.log(`Attending to incident: ${this.selectedIncident.id}`);this.incidents.findIndex((t=>t.id===this.selectedIncident.id));this.showConfirmModal=!1,this.map.closePopup(),alert(`You are now attending to incident ${this.selectedIncident.vehicleId}`),this.selectedIncident={}},addMarker(t){if(!t.lat||!t.lng)return void console.warn("Incident missing coordinates:",t);const e=this.getSeverityColor(t.score),i=this.createWarningIcon(e),n=L.divIcon({className:"marker-icon",html:i,iconSize:[30,30]}),s=L.marker([t.lat,t.lng],{icon:n}),a=this,o=`\n                        <div class="p-3">\n                            <h3 class="font-bold text-gray-800 mb-2 text-lg">Incident Details</h3>\n                            <div class="space-y-1 mb-4">\n                                <p class="text-sm"><strong>Vehicle:</strong> ${t.vehicleId||"Unknown"}</p>\n                                <p class="text-sm"><strong>Time:</strong> ${t.timestamp||"Unknown"}</p>\n                                <p class="text-sm"><strong>Severity:</strong> ${this.formatSeverity(t.score)}</p>\n                                <p class="text-sm"><strong>Description:</strong> ${t.description||"No description"}</p>\n                            </div>\n                            <div class="text-center">\n                                <button id="attend-btn-${t.id}" class="modern-button w-full bg-gradient-to-r from-blue-500 to-blue-700 text-white font-medium py-2 px-4 rounded-lg flex items-center justify-center">\n                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>\n                                    </svg>\n                                    Attend Incident\n                                </button>\n                            </div>\n                        </div>\n                    `,r=L.popup({maxWidth:300,className:"custom-popup"}).setContent(o);s.bindPopup(r),s.on("popupopen",(function(){document.getElementById(`attend-btn-${t.id}`).addEventListener("click",(function(){a.showAttendModal(t)}))})),s.addTo(this.map),this.markers.push(s)},initMap(){if(this.map=L.map("map").setView([-17.8275,31.0528],15),this.mapLayer=L.tileLayer("https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{attribution:"© Google Maps",maxZoom:17}).addTo(this.map),this.incidents&&this.incidents.length>0&&(console.log("Should indicate....."),this.incidents.forEach((t=>{this.addMarker(t)})),this.markers.length>0)){const t=new L.featureGroup(this.markers);this.map.fitBounds(t.getBounds().pad(.1))}},async fetchIncidentData(){try{let t;this.isLoading=!0;try{t=(await api.get("/api/v1/incidents",{headers:{"Content-Type":"application/json"}})).data}catch(e){console.warn("API not available, using mock data:",e),t=[{id:"1",vehicleId:"VEH-001",timestamp:(new Date).toLocaleTimeString(),lat:-17.8275,lng:31.0528,severity:8.5,description:"Vehicle collision detected",location:"Main Street & 5th Avenue"}]}t&&Array.isArray(t)&&(this.incidents=t.map((t=>({...t,id:t.id||`temp-${Math.random().toString(36).substring(2,9)}`,severity:void 0!==t.severity?t.severity:null,vehicleId:t.vehicleId||"Unknown",timestamp:t.timestamp||(new Date).toLocaleTimeString(),location:t.location||"Unknown location",description:t.description||"No description available"}))),console.log("Incidents updated:",this.incidents),this.map?this.updateMapMarkers():this.initMap(),this.lastUpdated=(new Date).toLocaleTimeString())}catch(t){console.error("Error fetching incident data:",t)}finally{this.isLoading=!1}},updateMapMarkers(){if(this.markers.forEach((t=>{this.map.removeLayer(t)})),this.markers=[],this.incidents.forEach((t=>{console.log(`Adding marker for incident ${t.id} at [${t.lat}, ${t.lng}]`),this.addMarker(t)})),this.markers.length>0){const t=new L.featureGroup(this.markers);this.map.fitBounds(t.getBounds().pad(.1))}},startPolling(){this.stopPolling(),this.fetchIncidentData(),this.fetchInterval=setInterval((()=>{this.fetchIncidentData()}),1e4)},stopPolling(){this.fetchInterval&&(clearInterval(this.fetchInterval),this.fetchInterval=null)}},created(){this.startPolling()},beforeUnmount(){this.stopPolling()},mounted(){this.$nextTick((()=>{this.map||this.initMap(),this.startPolling()}))}}).mount("#app");